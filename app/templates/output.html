<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Output</title>

    <style>
        body {
            font-family: Roboto, Arial, sans-serif;
            background-image: url('../static/pipes.png');
        }
        input[type=button] {
            background-color: #003DA5;
            color: white;
            padding: 14px 0;
            margin: 10px 0;
            border: 2px solid black;
            cursor: grab;
            width: 30%;
            font-weight: bold;
            font-size: 18pt;
            display: inline-block;
        }
        .buttons, .timer_box {
            text-align: center;
            margin: 24px 50px 12px;
        }
        .output_div{
            box-shadow: 0 35px 50px rgba( 0, 0, 0, 0.2 );
        }
        table {
            border-radius: 5px;
            /*font-size: 8pt;*/
            font-weight: normal;
            border: none;
            border-collapse: collapse;
            width: 100%;
            height: 75%;
            /*max-width: 100%;*/
            /*white-space: nowrap;*/
            background-color: white;
            table-layout: fixed;
        }
        td, th {
            text-align: center;
            padding: 8px;
            width: 100%;
        }
        td {
            border-right: 1px solid #f8f8f8;
            font-size: 10pt;
            width: 100%;
            word-wrap: break-word;
        }
        th {
            word-wrap: break-word;
        }
        thead th {
            color: #ffffff;
            background: #003DA5;
            width: 100%;
            font-size: 8pt;
        }
        .start_button:active {
            background: black;
        }
        .loading:after {
            content: "Running Model";
            background-color: firebrick;
            color: white;
            /*padding: 14px 0;*/
            padding: 14px 0;
            margin: 10px 0;
            border: 2px solid black;
            cursor: grab;
            width: 30%;
            font-weight: bold;
            font-size: 18pt;
            display: inline-block;
            text-align: center;
            /*margin: 24px 50px 12px;*/
        }
        #timer_box {
            display: none;
            background-color: #003DA5;
            color: white;
            padding: 14px 0;
            margin: 10px 0;
            border: 2px solid black;
            cursor: grab;
            width: 30%;
            font-weight: bold;
            font-size: 18pt;
        }
    </style>
</head>
<body>
<div class="buttons">
    <input type = "button" class="start_button button--loading" id="start_button" name="start" value="Start Model">
    <div class="load"> </div>
    <span class = "timer_box" id = "timer_box" >Next Output in  : 61 seconds</span>
    <a href="/remove">
        <input type = "button" id="stop_button" value="Stop Model">
    </a>
</div>



<div class = "output_div">
    <div id="out_id"> {{ output | safe}} </div>
</div>

<br><br>
<div class = "nightly_EVs">
    <div id="nightly_EVs"> {{night_EVs | safe}}</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    document.getElementById('start_button').addEventListener('click',startTimer);
    let incomeTicker = 61;

    function startTimer(){
        window.setInterval(function(){
            if (incomeTicker > 0)
                incomeTicker--;
            document.getElementById("timer_box").innerHTML = "Next Output in  : " + incomeTicker + " seconds";
            if (incomeTicker <= 0)
                incomeTicker = 61;
        }, 1000);
    }


    document.getElementById('start_button').addEventListener('click',StartFunction);
    document.getElementById('stop_button').addEventListener('click',StopFunction);

    function StartFunction(){
        runModel(true);
    }
    function StopFunction() {
        runModel(false);
    }

    let timer;

    function runModel(start_var){
        if (start_var) {
            timer = setInterval(function() {
                $.ajax({
                    url: "/run_model",
                    type: "POST",
                    success: function(data) {
                        document.getElementById('out_id').innerHTML=data;
                    }
                });
            }, 65000);
        } else {
            clearInterval(timer);
            timer=null;
        }
    }

    $('#start_button').on('click', function(){
        $('#start_button').hide();
        $('.load').addClass('loading');
        $('#timer_box').show().css('display', 'inline-block');
    });
</script>
</body>
<footer>

</footer>
</html>
